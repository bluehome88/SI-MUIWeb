!function(s){"use strict";var t=window.CandyFAQ,a=t.ajaxUrl,c=t.ajaxPrefix,l=t.optionPrefix,d=t.i18n;function f(){var a,n,i,r=s("body");function o(){a.off()}return a=s('<div class="mkb-popup-wrap"></div>'),i=n=null,s("body").append(a),{$el:a,render:function(e){var t,e=function(e,t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return e}(e,f.defaults);(n=a.find(".mkb-popup-overlay")).length||(n=s('<div class="mkb-popup-overlay"></div>'),a.append(n),r.css("overflow","hidden")),t=e,(e=a.find(".mkb-popup")).length&&e.remove(),(i=s('<div class="mkb-popup"><div class="mkb-popup__header mkb-clearfix"><div class="mkb-popup__header-controls--left"></div><div class="mkb-popup__header-title"></div><div class="mkb-popup__header-controls--right"></div></div><div class="mkb-popup__body"></div><div class="mkb-popup__footer mkb-clearfix"><div class="mkb-popup__footer-controls--left"></div><div class="mkb-popup__footer-controls--center"></div><div class="mkb-popup__footer-controls--right"></div></div></div>')).find(".mkb-popup__header-title").html(t.title),i.find(".mkb-popup__body").html(t.content),i.find(".mkb-popup__header-controls--left").html(t.headerControlsLeft.join("")),i.find(".mkb-popup__header-controls--right").html(t.headerControlsRight.join("")),i.find(".mkb-popup__footer-controls--left").html(t.footerControlsLeft.join("")),i.find(".mkb-popup__footer-controls--center").html(t.footerControlsCenter.join("")),i.find(".mkb-popup__footer-controls--right").html(t.footerControlsRight.join("")),a.append(i)},bindEvents:function(e){for(var t in o(),e){var n;e.hasOwnProperty(t)&&(2===(n=t.split(" ")).length&&a.on(n[0],n[1],e[t]))}},close:function(){a.html(""),r.css("overflow","")},destroy:function(){a.remove(),a=null,r.css("overflow",""),o(),0}}}function i(e){return e.nonce_key=t.nonce.nonceKey,e.nonce_value=t.nonce.nonce,e}function u(e,t){var n={method:"POST",url:a,dataType:"json",data:{}},n=t?_.extend({},n,t):n;return jQuery.ajax(_.extend({},n,{data:i(e)}),t)}function o(e,t){var n=t.dataset.type,a=s(t),i=null,r=null;switch(n){case"checkbox":case"toggle":r=(c=a.find('input[type="checkbox"]')).attr("name"),i=Boolean(c.attr("checked"));break;case"input":case"input_text":case"color":r=(c=a.find('input[type="text"]')).attr("name"),i=c.val();break;case"textarea":case"textarea_text":r=(c=a.find("textarea")).attr("name"),i=c.val();break;case"icon_select":case"image_select":case"layout_select":case"term_select":r=(c=a.find('input[type="hidden"]')).attr("name"),i=c.val();break;case"select":case"page_select":case"font":r=(c=a.find("select")).attr("name"),i=c.val();break;case"google_font_weights":case"google_font_languages":r=(c=a.find("select")).attr("name"),i=c.val()||"";break;case"css_size":var o=a.find(".fn-css-size-value"),c=a.find(".fn-css-size-unit-value"),r=o.attr("name"),i={unit:c.val(),size:o.val()};break;case"articles_list":o=a.find(".fn-related-article-item-select");r=a.attr("data-name"),i=Array.prototype.map.call(o,function(e){return s(e).val()}).join(",");break;default:return e}return e[r.replace("mkb_option_","")]=i,e}function n(e,t){var n=t.dataset.type,a=s(t),i=null,r=null;if("css_size"!==n)return o(e,t);t=a.find(".fn-css-size-value"),a=a.find(".fn-css-size-unit-value"),r=t.attr("name"),i=""+t.val()+a.val();return e[r.replace("mkb_option_","")]=i,e}function p(e){return Array.prototype.reduce.apply(e.find(".fn-control-wrap"),[o,{}])}function m(n,e,a){e.forEach(function(e){var t=e.id,t='.fn-control-wrap[data-name="'+a+t+'"]',t=n.find(t);t.length&&function(e,t){var n=e.dataset.type,a=s(e);switch(n){case"checkbox":case"toggle":a.find('input[type="checkbox"]').attr("checked","1"==t.value&&"chacked");break;case"input":case"input_text":case"color":a.find('input[type="text"]').val(t.value).trigger("change");break;case"textarea":case"textarea_text":a.find("textarea").val(t.value).trigger("change");break;case"icon_select":case"image_select":case"layout_select":case"term_select":a.find('input[type="hidden"]').val(t.value).trigger("change");break;case"select":case"page_select":case"font":a.find("select").val(t.value).trigger("change");break;case"css_size":var i=a.find(".fn-css-size-value"),r=a.find(".fn-css-size-unit-value"),o=JSON.parse(t.value);i.val(o.size).trigger("change"),r.val(o.unit).trigger("change")}}(t.get(0),e)})}f.defaults={title:"Dialog",content:"",headerControlsLeft:[],headerControlsRight:['<a href="#" class="fn-mkb-popup-close mkb-popup-close"><i class="fa fa-lg fa-times-circle"></i></a>'],footerControlsLeft:[],footerControlsCenter:[],footerControlsRight:[]};var b={getSearchParams:function(){return window.location.search.replace(/^\?/,"").split("&").map(function(e){e=e.split("=");return{name:decodeURIComponent(e[0]),value:decodeURIComponent(e[1])}})},getSearchParamByName:function(t){var n;return this.getSearchParams().some(function(e){if(e.name===t)return n=e.value,!0}),n},setSearchParam:function(t,n){var e=this.getSearchParams();e.some(function(e){if(e.name===t)return e.value=n,!0})||e.push({name:t,value:n}),history.pushState&&(e=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+e.map(function(e){return encodeURIComponent(e.name)+"="+encodeURIComponent(e.value)}).join("&"),window.history.pushState({path:e},"",e))}};function r(e){var t=s(e.currentTarget),n=t.data("value"),a=t.parents(".mkb-control-wrap"),e=a.find(".mkb-image-select__item"),a=a.find(".mkb-image-hidden-input");e.removeClass("mkb-image-selected"),t.addClass("mkb-image-selected"),a.val(n).trigger("change")}function g(e){var t=s(e.currentTarget),n=t.val(),e=t.parents(".mkb-control-wrap"),t=e.find(".mkb-image-select__item"),n=e.find('.mkb-image-select__item[data-value="'+n+'"]');t.removeClass("mkb-image-selected"),n.addClass("mkb-image-selected")}var e={set:function(e,t){localStorage.setItem(e,t)},get:function(e){return localStorage.getItem(e)},remove:function(e){localStorage.removeItem(e)}};window.CandyFAQ_UI={addAjaxNonce:i,fetch:u,handleErrors:function(e){e.errors&&e.errors.global?e.errors.global.forEach(function(e){toastr.error("<strong>Error "+e.code+"</strong>: "+e.error_message)}):toastr.error("Some unknown error happened")},debounce:function(a,i,r){var o;return function(){var e=this,t=arguments,n=r&&!o;clearTimeout(o),o=setTimeout(function(){o=null,r||a.apply(e,t)},i),n&&a.apply(e,t)}},throttle:function(a,i,r,o){var c,l=0;return"boolean"!=typeof i&&(o=r,r=i,i=void 0),function(){var e=+new Date-l,t=arguments,n=function(){l=+new Date,r.apply(this,t)}.bind(this);o&&!c&&n(),c&&clearTimeout(c),void 0===o&&a<e?n():!0!==i&&(c=setTimeout(o?function(){c=void 0}:n,void 0===o?a-e:a))}},getFormData:p,getFormDataForShortcode:function(e){return Array.prototype.reduce.apply(e.find(".fn-control-wrap"),[n,{}])},setupIconSelect:function(e){e.on("click",".mkb-icon-button__link",function(e){e.preventDefault();var t=s(e.currentTarget),n=t.parents(".mkb-control-wrap"),a=n.find(".mkb-icon-select"),e=n.find(".mkb-icon-select-filter"),n=e.find("input");a.toggleClass("mkb-hidden"),e.toggleClass("mkb-hidden"),t.toggleClass("mkb-pressed"),n.focus()}),e.on("click",".mkb-icon-select__item",function(e){e.preventDefault();var t=s(e.currentTarget),n=t.data("mkb-icon"),a=t.parents(".mkb-control-wrap"),i=a.find(".mkb-icon-button__link"),r=i.find(".mkb-icon-button__text"),o=i.find(".mkb-icon-button__icon"),c=a.find(".mkb-icon-select"),l=a.find(".mkb-icon-select-filter"),e=a.find(".mkb-icon-hidden-input"),a=a.find(".mkb-icon-select__item");c.addClass("mkb-hidden"),l.addClass("mkb-hidden"),i.removeClass("mkb-pressed"),r.text(n),o.attr("class","mkb-icon-button__icon fa fa-lg "+n),e.val(n).trigger("change"),a.removeClass("mkb-icon-selected"),t.addClass("mkb-icon-selected")}),e.find('.mkb-control-wrap[data-type="icon_select"]').each(function(e,t){var t=s(t),n=t.find(".mkb-icon-select__item");t.on("input",".mkb-icon-select-filter input",function(e){e=e.currentTarget.value.trim();e.length<2?n.removeClass("mkb-hidden"):(e=e,n.addClass("mkb-hidden"),n.filter("[data-mkb-icon*="+e+"]").removeClass("mkb-hidden"))})}),e.on("change",".mkb-icon-hidden-input",function(e){var t=s(e.currentTarget),n=t.val(),a=t.parents(".mkb-control-wrap"),i=a.find(".mkb-icon-select__item"),r=a.find('.mkb-icon-select__item[data-mkb-icon="'+n+'"]'),e=a.find(".mkb-icon-button__link"),t=e.find(".mkb-icon-button__text"),e=e.find(".mkb-icon-button__icon"),a=a.find(".mkb-icon-select-filter input");i.removeClass("mkb-icon-selected"),r.addClass("mkb-icon-selected"),t.text(n),e.attr("class","mkb-icon-button__icon fa fa-lg "+n),a.val(""),i.removeClass("mkb-hidden")})},setupTabs:function(e){e.each(function(e,t){var o=s(t);o.on("click",".mkb-settings-tab a",function(e){var t=s(e.currentTarget),n=o.find(".mkb-settings-tab a"),a=t.attr("href"),i=o.find(".mkb-settings-tab__container"),r=a.replace("#",""),a=r.replace(/^mkb_tab\-/,""),r=i.filter('[id="'+r+'"]');n.removeClass("active"),t.addClass("active"),i.removeClass("active"),r.addClass("active"),e.preventDefault(),b.setSearchParam("mkb_options_tab",a)});t=b.getSearchParamByName("mkb_options_tab");(t?o.find(".mkb-settings-tab a[href=#mkb_tab-"+t+"]"):o.find(".mkb-settings-tab a")).eq(0).click(),o.find("form, .mkb-form").removeClass("mkb-loading")})},setupColorPickers:function(e,n){e.find(".mkb-color-picker").wpColorPicker({change:function(e,t){e.target,t.color.toString();n&&n.onChange&&setTimeout(n.onChange,300)},clear:function(e){jQuery(e.target).siblings(".wp-color-picker")[0]&&n&&n.onChange&&setTimeout(n.onChange,300)}})},setupCSSSize:function(e){e.find(".mkb-css-size").each(function(e,t){var n=s(t),a=n.find(".fn-css-size-store"),i=n.find(".fn-css-size-value"),r=n.find(".fn-css-size-unit-value"),o=n.find(".fn-css-unit");function c(e){a.val(i.val()+r.val())}n.on("click",".fn-css-unit",function(e){e.preventDefault();e=s(e.currentTarget);o.removeClass("mkb-css-unit--selected"),e.addClass("mkb-css-unit--selected"),r.val(e.data("unit")),c()}),i.on("input",c),r.on("change",function(e){e=e.currentTarget.value;o.removeClass("mkb-css-unit--selected"),n.find('.fn-css-unit[data-unit="'+e+'"]').addClass("mkb-css-unit--selected"),c()})})},setupVCToggle:function(e){e.on("change",".fn-control.mkb-toggle",function(e){e=s(e.currentTarget);e.attr("value",e.attr("checked")?"on":"off")})},setupPageSelect:function(e){e.on("change",".fn-page-select-wrap .fn-control",function(e){var t=s(e.currentTarget),e=t.find("option:selected").data("link"),t=t.parents(".fn-page-select-wrap").find(".fn-page-select-link"),e=""!==e?e:"#";t.attr("href",e),t.attr("target","#"===e?"_self":"_blank"),t.toggleClass("mkb-disabled","#"===e)}),e.find(".fn-page-select-wrap .fn-control").trigger("change")},setupRelatedArticles:function(i){var r=i.find(".fn-related-article-add"),t=i.find(".fn-related-articles"),n=i.find(".fn-related-articles-value");function o(){var e=i.find(".fn-related-article-item-select");n.val(Array.prototype.map.call(e,function(e){return s(e).val()}).join(","))}o(),i.on("change",".fn-related-article-item-select",o),r.on("click",function(e){e.preventDefault();var a=r.text();r.text(d.loading).attr("disabled","disabled"),u({action:c+"_get_articles_list",currentId:r.data("id")}).then(function(e){var t=s('<div class="mkb-related-articles__item fn-related-article-item"></div>'),n=s('<select class="mkb-related-articles__select fn-related-article-item-select" name="mkb_related_articles[]"></select>');(e.articles||[]).forEach(function(e){n.append(s('<option value="'+e.id+'">'+e.title+"</option>"))});e=i.find(".fn-no-related-message");e.length&&e.remove(),t.append(n),t.append(s('<a class="mkb-related-articles__item-remove fn-related-remove mkb-unstyled-link" href="#"><i class="fa fa-close"></i></a>')),i.find(".fn-related-articles").append(t),r.text(a).attr("disabled",!1),o()})}),t.sortable({items:".mkb-related-articles__item",axis:"y",update:o}),t.on("click",".fn-related-remove",function(e){e.preventDefault(),s(e.currentTarget).parents(".mkb-related-articles__item").remove(),0===t.find(".mkb-related-articles__item").length&&t.append(s('<div class="fn-no-related-message mkb-no-related-message"><p>'+d["no-related"]+"</p></div>")),o()})},setupImageSelect:function(e){e.on("click",".mkb-image-select__item",r),e.on("change",".mkb-image-hidden-input",g)},setupTopicsSelect:function(r){r.find(".mkb-layout-select").each(function(e,t){var i=s(t);i.find(".mkb-layout-select__available, .mkb-layout-select__selected").sortable({connectWith:".mkb-layout-select__container",receive:function(e,t){i.find(".mkb-layout-select__available .mkb-layout-select__item");var n=i.find(".mkb-layout-select__selected .mkb-layout-select__item"),a=i.find(".mkb-layout-select__selected").parents(".mkb-control-wrap").find(".mkb-layout-hidden-input"),n=Array.prototype.reduce.apply(n,[function(e,t){return e.push(t.dataset.value),e},[]]);a.val(n.join(",")).trigger("change")},stop:function(){i.find(".mkb-layout-select__available .mkb-layout-select__item");var e=i.find(".mkb-layout-select__selected .mkb-layout-select__item"),t=i.find(".mkb-layout-select__selected").parents(".mkb-control-wrap").find(".mkb-layout-hidden-input"),e=Array.prototype.reduce.apply(e,[function(e,t){return e.push(t.dataset.value),e},[]]);t.val(e.join(",")).trigger("change")}});var n=i.parents(".fn-layout-editor-section");n.length||(n=i.parents(".mkb-settings-tab__container")),n.length||(n=i.parents(".fn-mkb-shortcode-options"));var a,t=(n.length?n:i).find('[data-name="mkb_option_home_view"]');t.length||(t=n.find('[data-name="mkb_option_view"]')),t.length?((a=t.find('input[type="hidden"]')).on("change",function(e){i.toggleClass("mkb-layout-select--box-view","box"===e.currentTarget.value)}),a.trigger("change")):r.hasClass("vc_active")&&((a=r.find('.wpb_vc_param_value[name="view"]')).on("change",function(e){i.toggleClass("mkb-layout-select--box-view","box"===e.currentTarget.value)}),a.trigger("change"))})},setupTermsSelect:function(e){e.find(".fn-terms-select-store").each(function(e,t){var n=s(t),t=n.parents(".mkb-control-wrap"),a=t.find(".fn-terms-tree"),t=t.find(".fn-terms-selected"),c=t.find("ul");function l(){var e=c.find("li");e.length?(e=[].map.call(e,function(e){return e.dataset.id}),n.val(e.join(",")),n.trigger("change")):n.val("")}c.find("li").append('<a href="#" class="mkb-term-delete"><i class="fa fa-times-circle"></i></a>'),t.sortable({items:"li",axis:"y",stop:l}),a.on("click","span",function(e){var t=e.currentTarget,n=s(t),a=t.dataset.id,i=(parseInt(t.dataset.count),t.dataset.path),r=n.find("input"),o=Boolean(r.attr("checked"));e.preventDefault(),e.stopImmediatePropagation(),r.attr("checked",!o),n.toggleClass("mkb-term-selected",!o),o?c.find('li[data-id="'+a+'"]').remove():c.append(s('<li data-id="'+a+'"><span>'+i+"</span>"+t.innerText+'<a href="#" class="mkb-term-delete"><i class="fa fa-times-circle"></i></a></li>')),l()}),t.on("click",".mkb-term-delete",function(e){var t=s(e.currentTarget).parent(),n=t[0].dataset.id;e.preventDefault(),e=n,n=a.find('span[data-id="'+e+'"]'),e=n.find("input"),parseInt(n[0].dataset.count),e.attr("checked",!1),n.removeClass("mkb-term-selected"),t.remove(),l()})})},setupDependencies:function(r){p(r);var o=[];function e(){var n=p(r);o.forEach(function(e){var t=n[e.config.target];switch(e.config.type){case"EQ":t==e.config.value?e.$el.slideDown():e.$el.hide();break;case"NEQ":t!=e.config.value?e.$el.slideDown():e.$el.hide()}})}r.find(".mkb-control-wrap[data-dependency]").each(function(e,t){var n,a=s(t),i=s(t).data("name");try{n=JSON.parse(t.dataset.dependency.replace(/^"/,"").replace(/"$/,""))}catch(e){console.log("DEV_INFO: Could not parse dependency config")}n&&(r.find('.mkb-control-wrap[data-name="'+l+n.target+'"]').addClass("fn-dependency-target"),o.push({_id:i.replace(l,""),$el:a,config:n}))}),r.on("change input",".fn-dependency-target",e),e()},setupPresetLoader:function(i,r,o){i.on("click",".fn-mkb-preset-link",function(e){var t=e.currentTarget,n=s(t).parents(".mkb-control-wrap"),a=t.dataset.field,t=t.dataset.preset;e.preventDefault(),confirm("Apply preset? This will change style settings.")&&(n.addClass("mkb-request-pending"),u({action:c+"_get_preset_options",field:a,preset:t,isShortcode:o}).then(function(e){console.log(e),m(i,e.values,r),n.removeClass("mkb-request-pending"),toastr.info("<strong>Style settings changed!</strong> Please, save settings.")}))})},storage:e,Popup:f}}(jQuery);